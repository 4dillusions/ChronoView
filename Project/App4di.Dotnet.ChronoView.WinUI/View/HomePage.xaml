<Page
    x:Class="App4di.Dotnet.ChronoView.WinUI.View.HomePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
    xmlns:Controls="using:App4di.Dotnet.ChronoView.WinUI.Control"
    xmlns:viewmodel="using:App4di.Dotnet.ChronoView.Infrastructure.ViewModel"
    NavigationCacheMode="Required">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="200" />
        </Grid.RowDefinitions>
        
        <!-- Image view -->
        <Border Grid.Row="0" Margin="8" CornerRadius="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                
                <!-- Image -->
                <ScrollViewer x:Name="ImageScroller" Grid.Row="0" ZoomMode="Enabled" MinZoomFactor="0.1" MaxZoomFactor="8" HorizontalScrollMode="Auto" VerticalScrollMode="Auto" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" SizeChanged="ImageScroller_SizeChanged">
                    <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Image x:Name="ImageView" Stretch="Uniform" RenderTransformOrigin="0.5,0.5" Source="{x:Bind ViewModel.SelectedImageItem.ImagePath, Mode=OneWay}" SizeChanged="ImageView_SizeChanged"> 
                            <Image.RenderTransform>
                                <RotateTransform x:Name="ImgRotate" Angle="0"/>
                            </Image.RenderTransform>
                        </Image>
                    </Grid>
                </ScrollViewer>

                <!-- Menu -->
                <CommandBar Grid.Row="1" DefaultLabelPosition="Right" IsSticky="True">
                    <AppBarSeparator/>
                    <AppBarButton Icon="OpenFile" Label="Open folder" Command="{x:Bind ViewModel.OpenFolderCommand, Mode=OneWay}"/>
                    <AppBarSeparator/>
                    
                    <AppBarButton Icon="Back" Label="Back" Command="{x:Bind ViewModel.BackCommand, Mode=OneWay}"/>
                    <AppBarButton Icon="Forward" Label="Next" Command="{x:Bind ViewModel.NextCommand, Mode=OneWay}"/>
                    <AppBarSeparator/>

                    <AppBarButton Label="Play / Pause" Command="{x:Bind ViewModel.PlayPauseCommand, Mode=OneWay}">
                        <AppBarButton.Icon>
                            <FontIcon Glyph="{x:Bind ViewModel.PlayPauseGlyph, Mode=OneWay}"/>
                        </AppBarButton.Icon>
                    </AppBarButton>
                    <AppBarSeparator/>

                    <AppBarButton Icon="ZoomOut" Label="Zoom out" Command="{x:Bind ViewModel.ZoomOutCommand, Mode=OneWay}"/>
                    <AppBarButton Icon="ZoomIn"  Label="Zoom in"  Command="{x:Bind ViewModel.ZoomInCommand, Mode=OneWay}"/>
                    <AppBarButton Icon="Zoom" Label="Reset zoom" Command="{x:Bind ViewModel.ResetZoomCommand, Mode=OneWay}"/>
                    <AppBarSeparator/>
                    
                    <AppBarButton Icon="Rotate" Label="Rotate" Command="{x:Bind ViewModel.RotateCommand, Mode=OneWay}"/>
                </CommandBar>
            </Grid>
        </Border>
        
        <!-- Timeline view -->
        <Border Grid.Row="1" 
         Margin="8" 
         CornerRadius="12" 
         Background="{ThemeResource App.SurfaceBrush}"
         BorderBrush="{ThemeResource App.SurfaceBorderBrush}"
         BorderThickness="1">
            <Controls:TimelineControl x:Name="Timeline" Margin="8" IsLocked="{x:Bind ViewModel.IsAutoPlay, Mode=OneWay}"/>
        </Border>
    </Grid>
</Page>